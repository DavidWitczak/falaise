<div class="container">

  <div class="mb-4">
    {% for cat in node.field_cat_agenda %}
      <div class="tag tag-red">{{ cat.entity.name.value }}</div>
    {% endfor %}
  </div>

  <h1>{{ node.title.value }}</h1>

  <div class="row">
    <div class="col-lg-5">
      <div class="row">
        <div class="col-lg-9 pr-0">
          {% set media = getMediaInfos(node.field_medias.target_id, 'carre_crop') %}
          <img class="w-100" title="{{ media.name }} - {{ media.title }}" alt="{{ media.alt }}" src="{{ media.url }}">
        </div>
        <div class="col-lg-3 bg-red txt-white date-event ml-md-3 pl-md-0 ml-sm-3 ml-lg-0">
          <div class="row my-lg-5 pt-lg-4 py-md-3 py-sm-3 bebas text-align-center">
            <div class="col-lg-12 col-sm-2 col-md-1 offset-lg-0 offset-md-4 offset-sm-3">
              {% if(node.field_date_debut.value) %}
                <div class="m-0 h2">{{ node.field_date_debut.value|date('d') }}</div>
                <div>{{ node.field_date_debut.value|date('U')|format_date('mois_fr') }}</div>
                <div>{{ node.field_date_debut.value|date('Y') }}</div>
              {% endif %}
            </div>
            {% if(node.field_date_fin.value and node.field_date_debut.value != node.field_date_fin.value) %}
              <div class="col-lg-12 col-sm-1 col-md-1 pt-lg-0 pt-md-3 pt-sm-3">
                <div class="d-sm-none d-lg-block"><i class="fas fa-arrow-down txt-white font-big"></i></div>
                <div class="d-sm-block d-lg-none"><i class="fas fa-arrow-right txt-white font-big"></i></div>
              </div>
              <div class="col-lg-12 col-sm-2 col-md-1">
                <div class="m-0 h2">{{ node.field_date_fin.value|date('d') }}</div>
                <div>{{ node.field_date_fin.value|date('U')|format_date('mois_fr') }}</div>
                <div>{{ node.field_date_fin.value|date('Y') }}</div>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-7">
      <h5 class="font-weight-bold text-uppercase">{{ node.field_sous_titre.value }}</h5>

      {% if node.field_infos_sup.value %}
        <p class="mt-3">
          <span class="font-weight-bold">Infos complémentaires :</span>
          {{ node.field_infos_sup.value }}
        </p>
      {% endif %}

      <div class="row justify-content-between mt-3">
        {% if node.field_horaire.value %}
          <div class="col-lg-3 border-right">
            <i class="far fa-clock mr-2 txt-red"></i>{{ node.field_horaire.value }}
          </div>
        {% endif %}

        {% if node.field_duree.value %}
          <div class="col-lg-4 border-right">
            <i class="fas fa-hourglass-half mr-2 ml-lg-4 txt-red"></i>{{ node.field_duree.value }}
          </div>
        {% endif %}

        {% if node.field_tarif.value %}
          <div class="col-lg-5">
            <i class="fas fa-euro-sign mr-2 ml-lg-4 txt-red"></i>{{ node.field_tarif.value }}
          </div>
        {% endif %}

        {% if node.field_lieu.value %}
          <div class="col-lg-12 mt-lg-3">
            <i class="fas fa-map-marker-alt mr-2 txt-red"></i>{{ node.field_lieu.value }}
          </div>
        {% endif %}
      </div>

      {% if node.field_reservation.value %}
        <div class="mt-3">{{ bamboo_render_field('field_reservation', 'node') }}</div>
      {% endif %}

      {% if node.field_link_resa.value %}
      <div class="btn bg-red txt-white">{{ bamboo_render_field('field_link_resa', 'node') }}</div>
      {% endif %}

      {% if node.field_public.entity.name.value %}
        <div class="mt-3">
          <span class="font-weight-bold">Public :</span> {{ node.field_public.entity.name.value }}
        </div>
      {% endif %}

      <div class="mt-3">
        {% for access in node.field_accessibilite %}
          <img class="mr-2" width="40" title="{{ access.entity.name.value }}"
               src="/{{ directory }}/images/access_{{ access.value.target_id }}.png">
        {% endfor %}
      </div>

    </div>
  </div>

  <div class="chapo mt-4">{{ bamboo_render_field('field_chapo', 'node') }}</div>

  <div class="my-3">{{ bamboo_render_field('field_description', 'node') }}</div>

  {% if node.field_medias|length > 1 %}
  <div class="row mt-6">
    {% for image in node.field_medias %}
      {% if loop.index != 1 %}
        {% set media = getMediaInfos(image.target_id, 'paysage_crop') %}
        <div class="col-lg-4 p-0">
          <a href="{{ media.url_full }}" data-fancybox="gallery" data-caption="{{ media.name }} - {{ media.copy }}">
            <img class="w-100" title="{{ media.name }} - {{ media.copy }}" alt="{{ media.alt }}" src="{{ media.url }}">
          </a>
        </div>
      {% endif %}
    {% endfor %}
  </div>
  {% endif %}

  {% if node.field_audio.target_id is not empty %}
    <div class="border-top mt-6 pt-4">
      {% for audio in node.field_audio %}
        <div class="mb-5">
          {{ bamboo_render_entity('media', audio.target_id) }}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  {% if node.field_videos.target_id is not empty %}
    <div class="mt-6 text-align-center">
      {% for video in node.field_videos %}
        <div class="mb-5 video txt-grey pb-4">
          {{ bamboo_render_entity('media', video.target_id) }}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  {% if node.field_liens|length > 0 or node.field_fichiers|length > 0 %}
    <div class="my-3 bg-black txt-white pt-3 pb-4 px-4 mt-5">
      <h2 class="mx-3 bebas text-uppercase">Pour aller plus loin</h2>
      <div>
        {{ bamboo_render_field('field_liens', 'node') }}
        {{ bamboo_render_field('field_fichiers', 'node') }}
      </div>
    </div>
  {% endif %}

  {% if node.field_prog_assoc.target_id != '' %}
    <h1 class="mt-6"><span class="txt-red">événements</span> associés</h1>
    <div class="row mt-3">
      {% for agenda in node.field_prog_assoc %}
        {% set event = bamboo_load_entity('node', agenda.target_id) %}
        {% set cat = event.field_cat_agenda %}
        {% set url = path('entity.node.canonical', {'node': agenda.target_id}) %}
        {% set media = getMediaInfos(event.field_medias.target_id, 'portrait_crop') %}
        <div class="col-lg-4 mb-4">
          <a href="{{ url }}">
            <img class="w-100" title="{{ media.name }} - {{ media.title }}" alt="{{ media.alt }}" src="{{ media.url }}">
            <div class="infos-object">
              <div class="infos-content">
                <div class="row align-items-end">
                  <div class="col-8 p-0">
                    <div class="tag tag-red mb-2 font-small">{{ cat.entity.name.value }}</div>
                    <h2 class="bebas">{{ event.title.value }}</h2>
                    <p>{{ event.field_lieu.value }}</p>
                  </div>
                  <div class="col-4 pr-0 pl-1 line-h">
                    <div class="col-lg-12 col-md-1 font-small">
                      <div class="h3 m-0">{{ event.field_date_debut.value|date('U')|date("d") }}</div>
                      <div>{{ event.field_date_debut.value|date('U')|format_date('mois_fr') }}</div>
                      <div>{{ event.field_date_debut.value|date('U')|date("Y") }}</div>
                    </div>
                    {% if(event.field_date_fin.value and event.field_date_debut.value != event.field_date_fin.value) %}
                      <div class="col-lg-12 col-md-1">
                        <div class="my-2 d-md-none d-lg-block"><i class="fas fa-arrow-down txt-white font-big"></i>
                        </div>
                        <div class="d-md-block d-lg-none"><i class="fas fa-arrow-right txt-white font-big"></i></div>
                      </div>
                      <div class="col-lg-12 col-md-1 font-small">
                        <div class="h3 m-0">{{ event.field_date_fin.value|date('U')|date("d") }}</div>
                        <div>{{ event.field_date_fin.value|date('U')|format_date('mois_fr') }}</div>
                        <div>{{ event.field_date_fin.value|date('U')|date("Y") }}</div>
                      </div>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          </a>
        </div>
      {% endfor %}
    </div>
    <div class="font-big mb-4">
      <a href="/agenda">
        <i class="far fa-calendar txt-red"></i>
        <span class="text-uppercase bebas hover-red">Toute la programmation</span>
        <i class="fas fa-arrow-right"></i>
      </a>
    </div>
  {% endif %}
</div>

